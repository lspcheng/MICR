---
title: "AXB Extras"
output: html_notebook
---


# ...

## Continuous Step Regression
### Bayesian (brm)

#### Models
```{r}
prior1 <- prior(normal(0,5), class = b)

## First run on 3/11 ##
# cont_au_bm <- brm(respRS ~ step + speakerGuise + step:speakerGuise +
#                        (1 | participantId) + (0 + step | participantId) +
#                        (1 | word) + (0 + step | word),
#                     data = au_data_coded,
#                     family = 'bernoulli',
#                     prior = prior1,
#                     control = list(adapt_delta = 0.99), # default is 0.8
#                     cores=4)

summary(cont_au_bm)
```

#### Extract Group Estimates
```{r}
fixef_au <- fixef(cont_au_bm)
```

```{r}
# Calculate intercepts per guise
( int_bl <- fixef_au[[1]] )
( int_cn <- int_bl + fixef_au[[3]] )
( int_mi <- int_bl + fixef_au[[4]] )

# Calculate slopes per guise
( slope_bl <- fixef_au[[2]] )
( slope_cn <- slope_bl + fixef_au[[5]] )
( slope_mi <- slope_bl + fixef_au[[6]] )

```

```{r}
# Double check intercept values to guise means
au_data_coded %>% group_by(speakerGuise) %>%
  summarize(propRS = mean(respRS), logOddsRS = logit_scaled(mean(respRS))) %>%
  mutate(intercepts = c(int_bl, int_cn, int_mi),
         slopes = c(slope_bl, slope_cn, slope_mi)) %>%
  mutate(mean_int_diff = intercepts - logOddsRS)

```

```{r}
# Calculate x-intercepts per guise, i.e., where y=0, using the formula [y = ax + b]  ~  [x = -b/a]
( xint_bl = -(int_bl / slope_bl) )
( xint_cn = -(int_cn / slope_cn) )
( xint_mi = -(int_mi / slope_mi) )

```

#### Prediction Plots

```{r eval=F, include=F}
# Predict on original/actual data (Option 2: LogOdds)
cont_au_pred_actual <-
  filter(axb_data_coded, vowel=='AU') %>%
  mutate(predictions =  predict(cont_au_bm, type = "link") )
# cont_au_pred_actual

cont_au_pred_actual %>% ggplot(aes(x=step, y=predictions, color=speakerGuise)) %>% 
  guise_colors(3) +
  theme_minimal() +
  geom_smooth(method="glm", se=T) +
  # geom_point(alpha=0.1) +
  geom_vline(xintercept = xint_bl) +
  geom_vline(xintercept = xint_cn) +
  geom_vline(xintercept = xint_mi) + 
  geom_vline(xintercept = xint_bl, linetype="solid") +
  geom_vline(xintercept = xint_cn, linetype="dashed") +
  geom_vline(xintercept = xint_mi, linetype="dashed")

```

```{r eval=F, include=F}
# Predict on original/actual data (Option 2: Proportions)
cont_au_pred_actual <-
  filter(axb_data_coded, vowel=='AU') %>%
  mutate(predictions =  predict(cont_au_bm, type = "response") )
# cont_au_pred_actual

au_pred_plot <-
cont_au_pred_actual %>% ggplot(aes(x=step, y=predictions, 
                                   color=speakerGuise, fill=speakerGuise, linetype=speakerGuise)) %>% 
  proportion_plot_theme() +
  facet_grid(~vowel) +
  scale_linetype_manual(values=c("dotdash", "longdash", "solid")) +
  scale_y_continuous(breaks=seq(0,1,0.1)) +
  coord_cartesian(ylim = c(0.15, 0.85)) + 
  geom_smooth(method="loess", se=T, alpha=0.5)
au_pred_plot

ggsave(path="plots", filename="au_group_prop_nocross_pred.png", au_pred_plot, width=12, height=8, units = "in" , dpi=72)

au_pred_plot <-
cont_au_pred_actual %>% ggplot(aes(x=step, y=predictions, 
                                   color=speakerGuise, fill=speakerGuise, linetype=speakerGuise)) %>% 
  proportion_plot_theme() +
  facet_grid(~vowel) +
  scale_linetype_manual(values=c("dotdash", "longdash", "solid")) +
  scale_y_continuous(breaks=seq(0,1,0.1)) +
  coord_cartesian(ylim = c(0.15, 0.85)) + 
  geom_smooth(method="loess", se=T, alpha=0.5) +
  # geom_point(alpha=0.1) + 
  geom_vline(xintercept = xint_bl, linetype="solid") +
  geom_vline(xintercept = xint_cn, linetype="dashed") +
  geom_vline(xintercept = xint_mi, linetype="dashed")
au_pred_plot

ggsave(path="plots", filename="au_group_prop_cross_pred.png", au_pred_plot, width=12, height=8, units = "in" , dpi=72)
```

# .
## Coef Ind Regression
### Extract Individual Estimates
For these calculations:
* yint_bl = Intercept
* slope_bl = step
* yint_cn = Intercept + guiseCN
* slope_cn = step + step.guiseCN
* xint_bl = yint_bl / slope_bl
* xint_cn = yint_cn / slope_cn

```{r}
# Extract individual coefficients (based on random effects)
# ranef_au_bm <- ranef(cont_au_bm)[['participantId']][,c('Estimate', 'Est.Error'), 'Intercept']

coef_au_yint_bm <- data.frame(
  coef(cont_au_bm)[['participantId']][,c('Estimate', 'Est.Error'), 'Intercept']
  ) %>% rownames_to_column("participantId") %>%
  rename_all(~ sub("^E", "intercept_E", .x))

coef_au_slope_bm <- coef_au_yint_bm <- data.frame(
  coef(cont_au_bm)[['participantId']][,c('Estimate', 'Est.Error'), 'step']
  ) %>% rownames_to_column("participantId") %>%
  rename_all(~ sub("^E", "step_E", .x))

coef_au_cn_bm <- data.frame(
  coef(cont_au_bm)[['participantId']][,c('Estimate', 'Est.Error'), 'speakerGuiseCN']
  ) %>% rownames_to_column("participantId") %>%
  rename_all(~ sub("^E", "speakerGuiseCN_E", .x))

coef_au_mi_bm <- data.frame(
  coef(cont_au_bm)[['participantId']][,c('Estimate', 'Est.Error'), 'speakerGuiseMI']
  ) %>% rownames_to_column("participantId") %>%
  rename_all(~ sub("^E", "speakerGuiseMI_E", .x))

coef_au_slopecn_bm <- data.frame(
  coef(cont_au_bm)[['participantId']][,c('Estimate', 'Est.Error'), 'step:speakerGuiseCN']
  ) %>% rownames_to_column("participantId") %>%
  rename_all(~ sub("^E", "step.speakerGuiseCN_E", .x))

coef_au_slopemi_bm <- data.frame(
  coef(cont_au_bm)[['participantId']][,c('Estimate', 'Est.Error'), 'step:speakerGuiseMI']
  ) %>% rownames_to_column("participantId") %>%
  rename_all(~ sub("^E", "step.speakerGuiseMI_E", .x))
```

```{r warnings=F}
# Process coefficients
coef_au_bm <- coef_au_yint_bm %>%
  merge(., coef_au_slope_bm) %>%
  merge(., coef_au_cn_bm) %>%
  merge(., coef_au_mi_bm) %>%
  merge(., coef_au_slopecn_bm) %>%
  merge(., coef_au_slopemi_bm)
```


```{r warnings=F}
xints_coef_au_bm <- coef_au_bm %>%
  # Calculate xints per guise per individual (i.e., predicted patterns per guises that they didn't see)
  mutate(xint_bl = -(intercept_Estimate / step_Estimate),
         xint_cn = -((intercept_Estimate + speakerGuiseCN_Estimate) / 
                       (step_Estimate + step.speakerGuiseCN_Estimate)),
         xint_mi = -((intercept_Estimate + speakerGuiseMI_Estimate) / 
                       (step_Estimate + step.speakerGuiseMI_Estimate))) %>%
  select(participantId, xint_bl, xint_cn, xint_mi) %>%
  pivot_longer(., xint_bl:xint_mi, names_to="guise_pred", names_prefix="xint_", values_to="xint_pred", 
               names_transform = list(guise_pred = toupper)) %>%
  mutate_if(is.character,as.factor)
xints_coef_au_bm
```


#### Exploratory Plots (1)
```{r}
xints_coef_au_bm %>%
  ggplot(aes(x=participantId, y=xint_pred, color=guise_pred)) %>%
  guise_colors(3) +
  geom_point(alpha=0.5) +
  theme(axis.text.x =  element_blank()) +
  facet_wrap(~guise_pred) +
  coord_cartesian(ylim=c(-2, 2))
```


```{r}
xints_coef_au_bm %>%
 ggplot(aes(y=participantId, x=xint_pred, color=guise_pred)) %>% 
  guise_colors(3) +
  theme_minimal() +
  theme(axis.text.y = element_blank()) +
  xlim(-2,2) +
  geom_vline(xintercept = xint_bl) +
  geom_vline(xintercept = xint_cn) +
  geom_vline(xintercept = xint_mi) +
  geom_point(alpha=0.5)  

```

```{r}
xints_coef_au_bm %>% ggplot(aes(y=xint_pred, x=guise_pred, color=guise_pred)) %>% guise_colors(3) +
  theme_minimal() +
  coord_cartesian(ylim=c(-3, 3)) +
  geom_jitter(alpha=0.5) +
  geom_boxplot(alpha=0.8)
  
xints_coef_au_bm %>% ggplot(aes(x=xint_pred, y=reorder(guise_pred, desc(guise_pred)), color=guise_pred)) %>% guise_colors(3) +
  theme_minimal() +
  labs(y="guise_pred") +
  coord_cartesian(xlim=c(-3, 3)) +
  geom_jitter(alpha=0.3) +
  geom_boxplot(alpha=0.8)
  # geom_violin(alpha=0.8)

  
```

### Process Data + Outliers
#### V1: No Outlier removal
```{r}
Q1 <- quantile(xints_coef_au_bm$xint_pred, .25)
Q3 <- quantile(xints_coef_au_bm$xint_pred, .75)
IQR <- IQR(xints_coef_au_bm$xint_pred)

au_data_ind_coef_bm_v1 <- au_data_coded %>% 
  
  select(-step:-rt) %>% 
  # Match xints to participant data
  merge(., xints_coef_au_bm) %>%
  # merge(., rtscores) %>%
  
  # Filter out BL participants and predictions (for now..., may use for comparison or calculating measure)
  # filter(speakerGuise!='BL') %>%
  
  # Keep only the xint values of the guise that participants actually were assigned/completed
  filter(speakerGuise == guise_pred) %>%
  
  # Remove outliers of xint values beyond 1.5x the IQR (there are a few extreme outliers)
  # filter(xint_pred > Q1-IQR*4 & xint_pred < Q3+IQR*4) %>%

  # Create normalized guise bias/shift effect size score
  mutate(guiseShift = ifelse(speakerGuise == 'CN', -xint_pred, xint_pred)) %>%
  
  # Remove extra rows by summarizing
  distinct() %>%
  droplevels()

au_data_ind_coef_bm_noBL_v1 <- au_data_ind_coef_bm_v1 %>% filter(speakerGuise!='BL')
```

#### V2: Extreme Outliers (8)
```{r}
Q1 <- quantile(xints_coef_au_bm$xint_pred, .25)
Q3 <- quantile(xints_coef_au_bm$xint_pred, .75)
IQR <- IQR(xints_coef_au_bm$xint_pred)

au_data_ind_coef_bm_v2 <- au_data_coded %>% 
  
  select(-step:-rt) %>% 
  # Match xints to participant data
  merge(., xints_coef_au_bm) %>%
  # merge(., rtscores) %>%
  
  # Filter out BL participants and predictions (for now..., may use for comparison or calculating measure)
  # filter(speakerGuise!='BL') %>%
  
  # Keep only the xint values of the guise that participants actually were assigned/completed
  filter(speakerGuise == guise_pred) %>%
  
  # Remove outliers of xint values beyond 1.5x the IQR (there are a few extreme outliers)
  filter(xint_pred > Q1-IQR*8 & xint_pred < Q3+IQR*8) %>%

  # Create normalized guise bias/shift effect size score
  mutate(guiseShift = ifelse(speakerGuise == 'CN', -xint_pred, xint_pred)) %>%
  
  # Remove extra rows by summarizing
  distinct() %>%
  droplevels()

au_data_ind_coef_bm_noBL_v2 <- au_data_ind_coef_bm_v2 %>% filter(speakerGuise!='BL')
```

#### V3: Liberal Outliers (6)
```{r}
Q1 <- quantile(xints_coef_au_bm$xint_pred, .25)
Q3 <- quantile(xints_coef_au_bm$xint_pred, .75)
IQR <- IQR(xints_coef_au_bm$xint_pred)

au_data_ind_coef_bm_v3 <- au_data_coded %>% 
  
  select(-step:-rt) %>% 
  # Match xints to participant data
  merge(., xints_coef_au_bm) %>%
  # merge(., rtscores) %>%
  
  # Filter out BL participants and predictions (for now..., may use for comparison or calculating measure)
  # filter(speakerGuise!='BL') %>%
  
  # Keep only the xint values of the guise that participants actually were assigned/completed
  filter(speakerGuise == guise_pred) %>%
  
  # Remove outliers of xint values beyond 1.5x the IQR (there are a few extreme outliers)
  # filter(xint_pred > Q1-IQR*4 & xint_pred < Q3+IQR*4) %>%
  filter(xint_pred > Q1-IQR*4 & xint_pred < Q3+IQR*4) %>%
  
  # Create normalized guise bias/shift effect size score
  mutate(guiseShift = ifelse(speakerGuise == 'CN', -xint_pred, xint_pred)) %>%
  
  # Remove extra rows by summarizing
  distinct() %>%
  droplevels()

au_data_ind_coef_bm_noBL_v3 <- au_data_ind_coef_bm_v3 %>% filter(speakerGuise!='BL')
```

#### V4: Intermediate Outliers (3)
```{r}
Q1 <- quantile(xints_coef_au_bm$xint_pred, .25)
Q3 <- quantile(xints_coef_au_bm$xint_pred, .75)
IQR <- IQR(xints_coef_au_bm$xint_pred)

au_data_ind_coef_bm_v4 <- au_data_coded %>% 
  
  select(-step:-rt) %>% 
  # Match xints to participant data
  merge(., xints_coef_au_bm) %>%
  # merge(., rtscores) %>%
  
  # Filter out BL participants and predictions (for now..., may use for comparison or calculating measure)
  # filter(speakerGuise!='BL') %>%
  
  # Keep only the xint values of the guise that participants actually were assigned/completed
  filter(speakerGuise == guise_pred) %>%
  
  # Remove outliers of xint values beyond 1.5x the IQR (there are a few extreme outliers)
  # filter(xint_pred > Q1-IQR*4 & xint_pred < Q3+IQR*4) %>%
  filter(xint_pred > Q1-IQR*3 & xint_pred < Q3+IQR*3) %>%
  
  # Create normalized guise bias/shift effect size score
  mutate(guiseShift = ifelse(speakerGuise == 'CN', -xint_pred, xint_pred)) %>%
  
  # Remove extra rows by summarizing
  distinct() %>%
  droplevels()

au_data_ind_coef_bm_noBL_v4 <- au_data_ind_coef_bm_v4 %>% filter(speakerGuise!='BL')
```

#### V5: Conservative Outliers (2)
```{r}
Q1 <- quantile(xints_coef_au_bm$xint_pred, .25)
Q3 <- quantile(xints_coef_au_bm$xint_pred, .75)
IQR <- IQR(xints_coef_au_bm$xint_pred)

au_data_ind_coef_bm_v5 <- au_data_coded %>% 
  
  select(-step:-rt) %>% 
  # Match xints to participant data
  merge(., xints_coef_au_bm) %>%
  # merge(., rtscores) %>%
  
  # Filter out BL participants and predictions (for now..., may use for comparison or calculating measure)
  # filter(speakerGuise!='BL') %>%
  
  # Keep only the xint values of the guise that participants actually were assigned/completed
  filter(speakerGuise == guise_pred) %>%
  
  # Remove outliers of xint values beyond 1.5x the IQR (there are a few extreme outliers)
  filter(xint_pred > Q1-IQR*2 & xint_pred < Q3+IQR*2) %>%
  
  # Create normalized guise bias/shift effect size score
  mutate(guiseShift = ifelse(speakerGuise == 'CN', -xint_pred, xint_pred)) %>%
  
  # Remove extra rows by summarizing
  distinct() %>%
  droplevels()

au_data_ind_coef_bm_noBL_v5 <- au_data_ind_coef_bm_v5 %>% filter(speakerGuise!='BL')
```

#### V6: Standard Outliers (1.5)
```{r}
Q1 <- quantile(xints_coef_au_bm$xint_pred, .25)
Q3 <- quantile(xints_coef_au_bm$xint_pred, .75)
IQR <- IQR(xints_coef_au_bm$xint_pred)

au_data_ind_coef_bm_v6 <- au_data_coded %>% 
  
  select(-step:-rt) %>% 
  # Match xints to participant data
  merge(., xints_coef_au_bm) %>%
  # merge(., rtscores) %>%
  
  # Filter out BL participants and predictions (for now..., may use for comparison or calculating measure)
  # filter(speakerGuise!='BL') %>%
  
  # Keep only the xint values of the guise that participants actually were assigned/completed
  filter(speakerGuise == guise_pred) %>%
  
  # Remove outliers of xint values beyond 1.5x the IQR (there are a few extreme outliers)
  filter(xint_pred > Q1-IQR*1.5 & xint_pred < Q3+IQR*1.5) %>%
  
  # Create normalized guise bias/shift effect size score
  mutate(guiseShift = ifelse(speakerGuise == 'CN', -xint_pred, xint_pred)) %>%
  
  # Remove extra rows by summarizing
  distinct() %>%
  droplevels()

au_data_ind_coef_bm_noBL_v6 <- au_data_ind_coef_bm_v6 %>% filter(speakerGuise!='BL')
```

```{r}
# Check BL removals
setdiff(au_data_ind_coef_bm_v1, au_data_ind_coef_bm_noBL_v1)

setdiff(au_data_ind_coef_bm_v2, au_data_ind_coef_bm_noBL_v2)

setdiff(au_data_ind_coef_bm_v3, au_data_ind_coef_bm_noBL_v3)

setdiff(au_data_ind_coef_bm_v4, au_data_ind_coef_bm_noBL_v4)

setdiff(au_data_ind_coef_bm_v5, au_data_ind_coef_bm_noBL_v5)
```

```{r}
# Check outlier removals
setdiff(au_data_ind_coef_bm_v1, au_data_ind_coef_bm_v2) %>% select(-Age:-guise_pred)

setdiff(au_data_ind_coef_bm_v1, au_data_ind_coef_bm_v3) %>% select(-Age:-guise_pred)

setdiff(au_data_ind_coef_bm_v1, au_data_ind_coef_bm_v4) %>% select(-Age:-guise_pred)

setdiff(au_data_ind_coef_bm_v1, au_data_ind_coef_bm_v5) %>% select(-Age:-guise_pred)

setdiff(au_data_ind_coef_bm_v1, au_data_ind_coef_bm_v6) %>% select(-Age:-guise_pred)
```

```{r}
# Check Data numbers
au_data_ind_coef_bm %>% group_by(speakerGuise) %>% count() %>%
  merge(., au_data_ind_coef_bm %>% 
          group_by(speakerGuise) %>% 
          summarize(across(where(is.numeric), mean))
        ) %>% select(-MSscore_all, -guiseCN:-genderContr)

au_data_ind_coef_bm %>% group_by(speakerGuise) %>% count() %>%
  merge(., au_data_ind_coef_bm %>% 
          group_by(speakerGuise) %>% 
          summarize(across(where(is.numeric), min))
        ) %>% select(-MSscore_all, -guiseCN:-genderContr)

au_data_ind_coef_bm %>% group_by(speakerGuise) %>% count() %>%
  merge(., au_data_ind_coef_bm %>% 
          group_by(speakerGuise) %>% 
          summarize(across(where(is.numeric), max))
        ) %>% select(-MSscore_all, -guiseCN:-genderContr)
```


#### Exploratory Plots (2)
```{r}
au_data_ind_coef_bm_v3 %>% 
 ggplot(aes(x=xint_pred, fill=speakerGuise, color=speakerGuise)) %>%
  guise_colors(3) +
  theme_minimal() +
  theme(axis.text.y = element_blank()) +
  geom_density(alpha=0.4, binwidth=0.1) #+
  # coord_cartesian(xlim=c(-2, 2))
```


### Models

```{r}
# Are the three guises different in xint? YES all differenet
ind_au_lm_guise_bm <- lm(xint_pred ~ speakerGuise, data=au_data_ind_coef_bm_v3)
summary(ind_au_lm_guise_bm)

au_data_ind_coef_bm$guiseRelvl = relevel(au_data_ind_coef_bm$speakerGuise, ref="CN")
ind_au_lm_guise_bm_relvl <- lm(xint_pred ~ guiseRelvl, data=au_data_ind_coef_bm_v3)
summary(ind_au_lm_guise_bm_relvl)
```

```{r}
# Are the two guises different in xint? YES, they strongly go in opposite directions
ind_au_lm <- lm(xint_pred ~ guiseContr,
                data=au_data_ind_coef_bm_noBL_v3)
summary(ind_au_lm)

# Are the two guises different in guiseShift? YES, CN has slightly larger effect size
ind_au_lm <- lm(guiseShift ~ guiseContr,
                data=au_data_ind_coef_bm_noBL_v3)
summary(ind_au_lm)
```

```{r}
# Max model: More again, after adding in other controls
ind_au_lm_coef_bm <- lm(guiseShift ~ guiseContr + genderContr + scale(Age) + CEscore_all + 
                  SAscore_all * EQscore_all +
                  guiseContr:SAscore_all + guiseContr:EQscore_all + 
                  guiseContr:SAscore_all:EQscore_all, 
                  data=au_data_ind_coef_bm_noBL_v6)
summary(ind_au_lm_coef_bm)

```

# ... 

## Single-Point Regression
### Prepare DFs
```{r}
# Prep Data for Analysis

# Add contrast variables
axb_data_coded <- axb_all_data %>% filter(speaker=='S3') %>%
  mutate(item = as.factor(item),
         
    # Create step-as-factor variable 
        step.f=as.factor(step),
         
    # Deviation/Sum coding (compare to mean of factor)
         MI.CN=case_when(speakerGuise=='MI' ~ -0.5,
                         speakerGuise=='CN' ~ 0.5,
                         TRUE ~ 0),
         BL.CN=case_when(speakerGuise=='BL' ~ -0.5,
                         speakerGuise=='CN' ~ 0.5,
                         TRUE~0),
         BL.MI=case_when(speakerGuise=='BL' ~ -0.5,
                         speakerGuise=='MI' ~ 0.5,
                         TRUE~0),
    
    # Treatment/Baseline coding (compare to reference group)
        guiseCN=case_when(speakerGuise=='CN' ~ 1,
                         TRUE~0),
        guiseMI=case_when(speakerGuise=='MI' ~ 1,
                         TRUE~0))
  
  # Select and reorder relevant columns
  # select(experimentId, participantId:EQscore_all, respRS, raised_response, rt, rt_sec, 
  #        item, vowel, step, speakerGuise, speaker, word, speakerOrder, conditionId, guiseName, 
  #        step.f, guiseCN, guiseMI, BL.CN, BL.MI, MI.CN,)
```

```{r, eval=F}
# Get grand mean of propRS
axb_data_coded %>% filter(step==0) %>% filter(vowel=='AU') %>%
  group_by(experimentId, speakerGuise, vowel) %>% 
  summarize(meanlogRS = logit(mean(respRS)), selogRS = std.error(logit(respRS)),  meanRS = mean(respRS), seRS = std.error(respRS))


# Get grand mean of propRS
axb_data_coded %>% filter(step==0) %>% filter(vowel=='AU') %>%
  group_by(speakerGuise, vowel) %>% 
  summarize(meanlogRS = logit(mean(respRS)), selogRS = std.error(logit(respRS)),  meanRS = mean(respRS), seRS = std.error(respRS))

```

### Basic Binomial Regression 

#### Exp 1a
```{r}
# Old (1a) dataset
axb.glm.au <- glmer(respRS ~ speakerGuise + (1 | participantId) + (1 | item),
                    family = "binomial", 
                    control=glmerControl(optimizer="bobyqa", optCtrl=list(maxfun=2e5)),
                    data = axb_data_coded %>% filter(step == "0") %>% filter(vowel=='AU') %>% filter(experimentId=="1a")) 

summary(axb.glm.au)
```

#### Exp 1b
```{r}
# New (1b) dataset
axb.glm.au <- glmer(respRS ~ speakerGuise + (1 | participantId) + (1 | item),
                    family = "binomial", 
                    control=glmerControl(optimizer="bobyqa", optCtrl=list(maxfun=2e5)),
                    data = axb_data_coded %>% filter(step == "1") %>% filter(vowel=='AU')  %>% filter(experimentId=="1b")) 
summary(axb.glm.au)
```

#### Combined
```{r}
# Pooled dataset
axb.glm.au <- glmer(respRS ~ speakerGuise + (1 | participantId) + (1 | item),
                    family = "binomial", 
                    control=glmerControl(optimizer="bobyqa", optCtrl=list(maxfun=2e5)),
                    data = axb_data_coded %>% filter(step == "-1") %>% filter(vowel=='AU')) 
summary(axb.glm.au)
```

```{r}
# Pooled dataset
axb.glm.au <- glmer(respRS ~ speakerGuise + (1 | participantId) + (1 | item),
                    family = "binomial", 
                    control=glmerControl(optimizer="bobyqa", optCtrl=list(maxfun=2e5)),
                    data = axb_data_coded %>% filter(step == "1") %>% filter(vowel=='AU')) 
summary(axb.glm.au)
```

```{r}
# Pooled dataset
axb.glm.au <- glmer(respRS ~ guiseCN + guiseMI + (1 | participantId) + (1 | word),
                    family = "binomial", 
                    control=glmerControl(optimizer="bobyqa", optCtrl=list(maxfun=2e5)),
                    data = axb_data_coded %>% filter(step == "0") %>% filter(vowel=='AU')) 
summary(axb.glm.au)

fixef(axb.glm.au)
```

# ...

## IndScore Regression (Step 1)

### Prepare DFs
```{r}
fixef(axb.glm.au)[[1]]

axb_ind_data <- axb_data_coded %>% filter(step==1) %>% filter(vowel=='AU') %>% group_by(participantId, speakerGuise) %>%
  summarize(meanRS_prop = mean(respRS),
            meanRS_logOdds = logit(mean(respRS))) %>% 
  mutate(BLint_logOdds = fixef(axb.glm.au)[[1]]) %>%
  mutate(BLint_prop = inv_logit_scaled(BLint_logOdds)) %>%
  
  mutate(guiseBias_prop = ifelse(speakerGuise=='MI', -(meanRS_prop - BLint_prop), (meanRS_prop - BLint_prop))) %>%
  mutate(guiseBias_logOdds = ifelse(speakerGuise=='MI', -(meanRS_logOdds - BLint_logOdds), (meanRS_logOdds - BLint_logOdds))) %>%
  relocate(guiseBias_prop, .after=speakerGuise)

axb_ind_data
```

### GuiseBias Check

#### Midpoint PropRS by Ind
```{r fig.width=10}
# Density plot
axb_ind_data %>% ggplot(aes(x=meanRS_prop, color=speakerGuise, fill=speakerGuise)) %>%
  guise_colors(3) +
  gg_theme() +
  geom_density(alpha=0.3) +
  labs(x="Observed Proportion 'Raised'", color = "Guise", fill="Guise")

# Scatterplot
axb_ind_data %>% ggplot(aes(x=participantId, y=meanRS_prop, color=speakerGuise)) %>% 
  guise_colors(3) +
  gg_theme() +
  geom_point(size=5, alpha=0.7) + 
  geom_abline(aes(slope=0, intercept = BLint_prop)) +
  facet_grid(~speakerGuise) +
  labs(y="Observed Proportion 'Raised'", x = "Participant", color = "Guise")


# Boxplot
axb_ind_data %>% ggplot(aes(x=speakerGuise, y=meanRS_prop, color=speakerGuise)) %>%
  guise_colors(3) +
  gg_theme() +
  geom_violin(aes(fill = speakerGuise, color=speakerGuise), alpha=0.3, na.rm=TRUE) +
  geom_boxplot(aes(fill = speakerGuise), width=0.5, alpha=0.3, na.rm=TRUE) +
  geom_jitter(size=5, alpha=0.3)
  

```

#### Midpoint GuiseBias by Ind
```{r fig.width=10}
# Density plot
axb_ind_data %>% ggplot(aes(x=guiseBias_prop, color=speakerGuise, fill=speakerGuise)) %>%
  guise_colors(3)) +
  gg_theme() +
  geom_density(alpha=0.3) +
  labs(x="Guise Bias", color = "Guise", fill="Guise")

# Scatterplot
axb_ind_data %>% ggplot(aes(x=participantId, y=guiseBias_prop, color=speakerGuise)) %>% 
  guise_colors(3)) +
  gg_theme() +
  geom_point(size=5, alpha=0.7) + 
  geom_abline(aes(slope=0, intercept = 0)) +
  facet_grid(~speakerGuise) +
  labs(y="Guise Bias", x = "Participant", color = "Guise")

# Boxplot
axb_ind_data %>% ggplot(aes(x=speakerGuise, y=guiseBias_prop, color=speakerGuise)) %>%
  guise_colors(3)) +
  gg_theme() +
  geom_violin(aes(fill = speakerGuise, color=speakerGuise), alpha=0.3, na.rm=TRUE) +
  geom_boxplot(aes(fill = speakerGuise), width=0.5, alpha=0.3, na.rm=TRUE) +
  geom_jitter(size=5, alpha=0.3)


```

### Individual Regression
```{r}
# Only including mid-point currently
ind_data_coded <- axb_data_coded %>% 
  filter(step == "1") %>% filter(vowel=='AU') %>% 
  merge(., axb_ind_data) %>%
  mutate(genderContr = case_when(Gender=="f" ~ -0.5,
                                  Gender=="m" ~ 0.5,
                                 TRUE ~ 0),
         guiseContr = case_when(speakerGuise=="CN" ~ -0.5,
                                speakerGuise=="MI" ~ 0.5)) %>%
  mutate_if(is.character, as.factor)

# colnames(ind_data_coded)
# summary(ind_data_coded)
```

#### 1b
##### Basic
```{r}
lm.ind <- lm(guiseBias_prop ~ genderContr + guiseContr + 
               SAscore_all * EQscore_all +
               guiseContr:SAscore_all + guiseContr:EQscore_all + guiseContr:SAscore_all:EQscore_all,
             data=ind_data_coded %>% filter(experimentId=='1b'))
summary(lm.ind)
```
##### With CE
```{r}
lm.ind <- lm(guiseBias_prop ~ CEscore_all + genderContr + guiseContr + 
               SAscore_all * EQscore_all +
               guiseContr:SAscore_all + guiseContr:EQscore_all + guiseContr:SAscore_all:EQscore_all,
             data=ind_data_coded %>% filter(experimentId=='1b'))
summary(lm.ind)
```
##### With Age
```{r}
lm.ind <- lm(guiseBias_prop ~ Age + CEscore_all + genderContr + guiseContr + 
               SAscore_all * EQscore_all +
               guiseContr:SAscore_all + guiseContr:EQscore_all + guiseContr:SAscore_all:EQscore_all,
             data=ind_data_coded %>% filter(experimentId=='1b'))
summary(lm.ind)
```

#### Combined
##### Basic
```{r}
lm.ind <- lm(guiseBias_prop ~ genderContr + guiseContr + 
               SAscore_all * EQscore_all +
               guiseContr:SAscore_all + guiseContr:EQscore_all + guiseContr:SAscore_all:EQscore_all,
             data=ind_data_coded)
summary(lm.ind)
```

##### With CEscore
```{r}
lm.ind <- lm(guiseBias_prop ~ CEscore_all + genderContr + guiseContr + 
               SAscore_all * EQscore_all +
               guiseContr:SAscore_all + guiseContr:EQscore_all + guiseContr:SAscore_all:EQscore_all,
             data=ind_data_coded)
summary(lm.ind)
```

##### With Age
```{r}
lm.ind <- lm(guiseBias_prop ~ Age + CEscore_all + genderContr + guiseContr + 
               SAscore_all * EQscore_all +
               guiseContr:SAscore_all + guiseContr:EQscore_all + guiseContr:SAscore_all:EQscore_all,
             data=ind_data_coded)
summary(lm.ind)
```

### Plots

#### Categorical Plots
```{r}
# Boxplot
ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup() %>%
  filter(speakerGuise!="BL") %>%
  # filter(experimentId=='1b') %>%
  
  ggplot(aes(x=Gender, y=guiseBias_prop, color=Gender)) +
  gg_theme() +
  # facet_grid(~speakerGuise) +
  # geom_violin(aes(fill = Gender, color=Gender), alpha=0.3, na.rm=TRUE) +
  geom_jitter(size=2, alpha=0.3) +
  geom_boxplot(aes(fill = Gender), width=0.5, alpha=0.3, na.rm=TRUE) 
  
```

```{r}
# Boxplot
ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup() %>% 
  filter(speakerGuise!="BL") %>%
  # filter(experimentId=='1b') %>%
  
  ggplot(aes(x=speakerGuise, y=guiseBias_prop, color=speakerGuise)) +
  gg_theme() +
  # geom_violin(aes(fill = Gender, color=Gender), alpha=0.3, na.rm=TRUE) +
  geom_jitter(size=2, alpha=0.3) +
  geom_boxplot(aes(fill = speakerGuise), width=0.5, alpha=0.3, na.rm=TRUE) 
  
```



#### Continuous Plots
```{r}
# Scatterplot
ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup() %>% 
  filter(speakerGuise!="BL") %>%
  # filter(experimentId=='1b') %>%
  
  ggplot(aes(x=SAscore_all, y=guiseBias_prop, color=speakerGuise, shape=speakerGuise)) +
  scale_color_manual(values=ghibli_palette("PonyoMedium")[c(4,3)]) +
  gg_theme() +
  # facet_grid(~speakerGuise) +
  geom_point(size=2, alpha=0.5) +
  geom_smooth(method='lm', se=F) 

```

```{r}
# Scatterplot
ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup()  %>% 
  filter(speakerGuise!="BL") %>%
  # filter(experimentId=='1b') %>%
  
  # ggplot(aes(x=EQscore_all, y=guiseBias_prop))  +
  ggplot(aes(x=EQscore_all, y=guiseBias_prop, color=speakerGuise))  +
  scale_color_manual(values=ghibli_palette("PonyoMedium")[c(4,3)]) +
  gg_theme() +
  # facet_grid(~speakerGuise) +
  geom_point(aes(color=speakerGuise, shape=speakerGuise), size=2, alpha=0.5) +
  geom_smooth(method='lm', se=F)

```

```{r}
# Scatterplot
ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup() %>% filter(speakerGuise!="BL") %>%
  ggplot(aes(x=CEscore_all, y=guiseBias_prop))  +
  scale_color_manual(values=ghibli_palette("PonyoMedium")[c(4,3)]) +
  gg_theme() +
  geom_point(aes(color=speakerGuise),size=2, alpha=0.5) +
  geom_smooth(method='lm')

```

```{r}
# Scatterplot
ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup() %>% filter(speakerGuise!="BL") %>%
  ggplot(aes(x=Age, y=guiseBias_prop)) +
  scale_color_manual(values=ghibli_palette("PonyoMedium")[c(4,3)]) +
  gg_theme() +
  geom_point(aes(color=speakerGuise),size=5, alpha=0.5) +
  geom_smooth(method='lm')

```


#### Interaction
```{r}

ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup()  %>% 
  filter(speakerGuise!="BL") %>%
  # filter(experimentId=='1b') %>%
  
  mutate(EQgroups.3 = as.numeric(cut(EQscore_all, 3))) %>%
  mutate(EQgroups.3 = case_when(EQgroups.3 == 1 ~ "low",
                                EQgroups.3 == 2 ~ "mid",
                                EQgroups.3 == 3 ~ "high")) %>%
  relocate(EQgroups.3, .after=Ethnicity) %>%
  mutate(EQgroups.3 = factor(EQgroups.3, levels  = c("high", "mid", "low"))) %>%
  
  # group_by(EQgroups.3) %>% summarize(n=n(), meanEQ = mean(EQscore_all),min = min(EQscore_all),max = max(EQscore_all), range=max(EQscore_all)-min(EQscore_all))
  
  ggplot(aes(x=SAscore_all, y=guiseBias_prop, color=EQgroups.3))  +
  scale_color_manual(values=ghibli_palette("MononokeMedium")[c(5,6,7)])+
  gg_theme() +
  facet_grid(~speakerGuise) +
  geom_point(size=2, alpha=0.5) +
  geom_smooth(method='lm', se=F)
```

```{r}

ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup()  %>% 
  filter(speakerGuise!="BL") %>%
  # filter(experimentId=='1b') %>%
  
  mutate(EQgroups.3 = as.numeric(cut_number(EQscore_all, 3))) %>%
  mutate(EQgroups.3 = case_when(EQgroups.3 == 1 ~ "low",
                                EQgroups.3 == 2 ~ "mid",
                                EQgroups.3 == 3 ~ "high")) %>%
  relocate(EQgroups.3, .after=Ethnicity) %>%
  mutate(EQgroups.3 = factor(EQgroups.3, levels  = c("high", "mid", "low"))) %>%
  
  # group_by(EQgroups.3) %>% summarize(n=n(), meanEQ = mean(EQscore_all),min = min(EQscore_all),max = max(EQscore_all), range=max(EQscore_all)-min(EQscore_all))
  
  ggplot(aes(x=SAscore_all, y=guiseBias_prop, color=EQgroups.3))  +
  scale_color_manual(values=ghibli_palette("MononokeMedium")[c(5,6,7)])+
  gg_theme() +
  facet_grid(~speakerGuise) +
  geom_point(size=2, alpha=0.5) +
  geom_smooth(method='lm', se=F)


```

```{r}

ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup() %>% filter(speakerGuise!="BL") %>% mutate(EQgroups.4 = as.numeric(cut_number(EQscore_all, 4))) %>%
  mutate(EQgroups.4 = case_when(EQgroups.4 == 1 ~ "low",
                                EQgroups.4 == 2 ~ "mid-low",
                                EQgroups.4 == 3 ~ "mid-high",
                                EQgroups.4 == 4 ~ "high")) %>%
  relocate(EQgroups.4, .after=Ethnicity) %>%
  mutate(EQgroups.4 = factor(EQgroups.4, levels  = c("high", "mid-high", "mid-low", "low"))) %>%
  
  ggplot(aes(x=SAscore_all, y=guiseBias_prop, color=EQgroups.4))  +
  scale_color_manual(values=ghibli_palette("MononokeMedium")[c(2,5,6,7)])+
  gg_theme() +
  facet_grid(~speakerGuise) +
  geom_point(size=2, alpha=0.5) +
  geom_smooth(method='lm', se=F)


```

## IndScore Regression (Step -1)

### Prepare DFs
```{r}
fixef(axb.glm.au)[[1]]

axb_ind_data <- axb_data_coded %>% filter(step==-1) %>% filter(vowel=='AU') %>% group_by(participantId, speakerGuise) %>%
  summarize(meanRS_prop = mean(respRS),
            meanRS_logOdds = logit(mean(respRS))) %>% 
  mutate(BLint_logOdds = fixef(axb.glm.au)[[1]]) %>%
  mutate(BLint_prop = inv_logit_scaled(BLint_logOdds)) %>%
  
  mutate(guiseBias_prop = ifelse(speakerGuise=='MI', -(meanRS_prop - BLint_prop), (meanRS_prop - BLint_prop))) %>%
  mutate(guiseBias_logOdds = ifelse(speakerGuise=='MI', -(meanRS_logOdds - BLint_logOdds), (meanRS_logOdds - BLint_logOdds))) %>%
  relocate(guiseBias_prop, .after=speakerGuise)

axb_ind_data
```

### GuiseBias Check

#### Midpoint PropRS by Ind
```{r fig.width=10}
# Density plot
axb_ind_data %>% ggplot(aes(x=meanRS_prop, color=speakerGuise, fill=speakerGuise)) %>%
  guise_colors(3)) +
  gg_theme() +
  geom_density(alpha=0.3) +
  labs(x="Observed Proportion 'Raised'", color = "Guise", fill="Guise")

# Scatterplot
axb_ind_data %>% ggplot(aes(x=participantId, y=meanRS_prop, color=speakerGuise)) %>% 
  guise_colors(3)) +
  gg_theme() +
  geom_point(size=5, alpha=0.7) + 
  geom_abline(aes(slope=0, intercept = BLint_prop)) +
  facet_grid(~speakerGuise) +
  labs(y="Observed Proportion 'Raised'", x = "Participant", color = "Guise")


# Boxplot
axb_ind_data %>% ggplot(aes(x=speakerGuise, y=meanRS_prop, color=speakerGuise)) %>%
  guise_colors(3)) +
  gg_theme() +
  geom_violin(aes(fill = speakerGuise, color=speakerGuise), alpha=0.3, na.rm=TRUE) +
  geom_boxplot(aes(fill = speakerGuise), width=0.5, alpha=0.3, na.rm=TRUE) +
  geom_jitter(size=5, alpha=0.3)
  

```

#### Midpoint GuiseBias by Ind
```{r fig.width=10}
# Density plot
axb_ind_data %>% ggplot(aes(x=guiseBias_prop, color=speakerGuise, fill=speakerGuise)) %>%
  guise_colors(3)) +
  gg_theme() +
  geom_density(alpha=0.3) +
  labs(x="Guise Bias", color = "Guise", fill="Guise")

# Scatterplot
axb_ind_data %>% ggplot(aes(x=participantId, y=guiseBias_prop, color=speakerGuise)) %>% 
  guise_colors(3)) +
  gg_theme() +
  geom_point(size=5, alpha=0.7) + 
  geom_abline(aes(slope=0, intercept = 0)) +
  facet_grid(~speakerGuise) +
  labs(y="Guise Bias", x = "Participant", color = "Guise")

# Boxplot
axb_ind_data %>% ggplot(aes(x=speakerGuise, y=guiseBias_prop, color=speakerGuise)) %>%
  guise_colors(3)) +
  gg_theme() +
  geom_violin(aes(fill = speakerGuise, color=speakerGuise), alpha=0.3, na.rm=TRUE) +
  geom_boxplot(aes(fill = speakerGuise), width=0.5, alpha=0.3, na.rm=TRUE) +
  geom_jitter(size=5, alpha=0.3)


```

### Individual Regression
```{r}
# Only including mid-point currently
ind_data_coded <- axb_data_coded %>% 
  filter(step == "-1") %>% filter(vowel=='AU') %>% 
  merge(., axb_ind_data) %>%
  mutate(genderContr = case_when(Gender=="f" ~ -0.5,
                                  Gender=="m" ~ 0.5,
                                 TRUE ~ 0),
         guiseContr = case_when(speakerGuise=="CN" ~ -0.5,
                                speakerGuise=="MI" ~ 0.5)) %>%
  mutate_if(is.character, as.factor)

# colnames(ind_data_coded)
# summary(ind_data_coded)
```

#### 1b
##### Basic
```{r}
lm.ind <- lm(guiseBias_prop ~ genderContr + guiseContr + 
               SAscore_all * EQscore_all +
               guiseContr:SAscore_all + guiseContr:EQscore_all + guiseContr:SAscore_all:EQscore_all,
             data=ind_data_coded %>% filter(experimentId=='1b'))
summary(lm.ind)
```
##### With CE
```{r}
lm.ind <- lm(guiseBias_prop ~ CEscore_all + genderContr + guiseContr + 
               SAscore_all * EQscore_all +
               guiseContr:SAscore_all + guiseContr:EQscore_all + guiseContr:SAscore_all:EQscore_all,
             data=ind_data_coded %>% filter(experimentId=='1b'))
summary(lm.ind)
```
##### With Age
```{r}
lm.ind <- lm(guiseBias_prop ~ Age + CEscore_all + genderContr + guiseContr + 
               SAscore_all * EQscore_all +
               guiseContr:SAscore_all + guiseContr:EQscore_all + guiseContr:SAscore_all:EQscore_all,
             data=ind_data_coded %>% filter(experimentId=='1b'))
summary(lm.ind)
```

#### Combined
##### Basic
```{r}
lm.ind <- lm(guiseBias_prop ~ genderContr + guiseContr + 
               SAscore_all * EQscore_all +
               guiseContr:SAscore_all + guiseContr:EQscore_all + guiseContr:SAscore_all:EQscore_all,
             data=ind_data_coded)
summary(lm.ind)
```

##### With CEscore
```{r}
lm.ind <- lm(guiseBias_prop ~ CEscore_all + genderContr + guiseContr + 
               SAscore_all * EQscore_all +
               guiseContr:SAscore_all + guiseContr:EQscore_all + guiseContr:SAscore_all:EQscore_all,
             data=ind_data_coded)
summary(lm.ind)
```

##### With Age
```{r}
lm.ind <- lm(guiseBias_prop ~ Age + CEscore_all + genderContr + guiseContr + 
               SAscore_all * EQscore_all +
               guiseContr:SAscore_all + guiseContr:EQscore_all + guiseContr:SAscore_all:EQscore_all,
             data=ind_data_coded)
summary(lm.ind)
```

### Plots

#### Categorical Plots
```{r}
# Boxplot
ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup() %>%
  filter(speakerGuise!="BL") %>%
  # filter(experimentId=='1b') %>%
  
  ggplot(aes(x=Gender, y=guiseBias_prop, color=Gender)) +
  gg_theme() +
  # facet_grid(~speakerGuise) +
  # geom_violin(aes(fill = Gender, color=Gender), alpha=0.3, na.rm=TRUE) +
  geom_jitter(size=2, alpha=0.3) +
  geom_boxplot(aes(fill = Gender), width=0.5, alpha=0.3, na.rm=TRUE) 
  
```

```{r}
# Boxplot
ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup() %>% 
  filter(speakerGuise!="BL") %>%
  # filter(experimentId=='1b') %>%
  
  ggplot(aes(x=speakerGuise, y=guiseBias_prop, color=speakerGuise)) +
  gg_theme() +
  # geom_violin(aes(fill = Gender, color=Gender), alpha=0.3, na.rm=TRUE) +
  geom_jitter(size=2, alpha=0.3) +
  geom_boxplot(aes(fill = speakerGuise), width=0.5, alpha=0.3, na.rm=TRUE) 
  
```



#### Continuous Plots
```{r}
# Scatterplot
ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup() %>% 
  filter(speakerGuise!="BL") %>%
  # filter(experimentId=='1b') %>%
  
  ggplot(aes(x=SAscore_all, y=guiseBias_prop)) +
  # ggplot(aes(x=SAscore_all, y=guiseBias_prop, color=speakerGuise, shape=speakerGuise)) +
  scale_color_manual(values=ghibli_palette("PonyoMedium")[c(4,3)]) +
  gg_theme() +
  # facet_grid(~speakerGuise) +
  geom_point(size=2, alpha=0.5) +
  geom_smooth(method='lm', se=F) 

```

```{r}
# Scatterplot
ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup()  %>% 
  filter(speakerGuise!="BL") %>%
  # filter(experimentId=='1b') %>%
  
  ggplot(aes(x=EQscore_all, y=guiseBias_prop))  +
  # ggplot(aes(x=EQscore_all, y=guiseBias_prop, color=speakerGuise))  +
  scale_color_manual(values=ghibli_palette("PonyoMedium")[c(4,3)]) +
  gg_theme() +
  # facet_grid(~speakerGuise) +
  geom_point(aes(color=speakerGuise, shape=speakerGuise), size=2, alpha=0.5) +
  geom_smooth(method='lm', se=F)

```

```{r}
# Scatterplot
ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup() %>% filter(speakerGuise!="BL") %>%
  ggplot(aes(x=CEscore_all, y=guiseBias_prop))  +
  scale_color_manual(values=ghibli_palette("PonyoMedium")[c(4,3)]) +
  gg_theme() +
  geom_point(aes(color=speakerGuise),size=2, alpha=0.5) +
  geom_smooth(method='lm')

```

```{r}
# Scatterplot
ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup() %>% filter(speakerGuise!="BL") %>%
  ggplot(aes(x=Age, y=guiseBias_prop)) +
  scale_color_manual(values=ghibli_palette("PonyoMedium")[c(4,3)]) +
  gg_theme() +
  geom_point(aes(color=speakerGuise),size=5, alpha=0.5) +
  geom_smooth(method='lm')

```


#### Interaction
```{r}

ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup()  %>% 
  filter(speakerGuise!="BL") %>%
  # filter(experimentId=='1b') %>%
  
  mutate(EQgroups.3 = as.numeric(cut(EQscore_all, 3))) %>%
  mutate(EQgroups.3 = case_when(EQgroups.3 == 1 ~ "low",
                                EQgroups.3 == 2 ~ "mid",
                                EQgroups.3 == 3 ~ "high")) %>%
  relocate(EQgroups.3, .after=Ethnicity) %>%
  mutate(EQgroups.3 = factor(EQgroups.3, levels  = c("high", "mid", "low"))) %>%
  
  # group_by(EQgroups.3) %>% summarize(n=n(), meanEQ = mean(EQscore_all),min = min(EQscore_all),max = max(EQscore_all), range=max(EQscore_all)-min(EQscore_all))
  
  ggplot(aes(x=SAscore_all, y=guiseBias_prop, color=EQgroups.3))  +
  scale_color_manual(values=ghibli_palette("MononokeMedium")[c(5,6,7)])+
  gg_theme() +
  # facet_grid(~speakerGuise) +
  geom_point(size=2, alpha=0.5) +
  geom_smooth(method='lm', se=F)
```

```{r}

ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup()  %>% 
  filter(speakerGuise!="BL") %>%
  # filter(experimentId=='1b') %>%
  
  mutate(EQgroups.3 = as.numeric(cut_number(EQscore_all, 3))) %>%
  mutate(EQgroups.3 = case_when(EQgroups.3 == 1 ~ "low",
                                EQgroups.3 == 2 ~ "mid",
                                EQgroups.3 == 3 ~ "high")) %>%
  relocate(EQgroups.3, .after=Ethnicity) %>%
  mutate(EQgroups.3 = factor(EQgroups.3, levels  = c("high", "mid", "low"))) %>%
  
  # group_by(EQgroups.3) %>% summarize(n=n(), meanEQ = mean(EQscore_all),min = min(EQscore_all),max = max(EQscore_all), range=max(EQscore_all)-min(EQscore_all))
  
  ggplot(aes(x=SAscore_all, y=guiseBias_prop, color=EQgroups.3))  +
  scale_color_manual(values=ghibli_palette("MononokeMedium")[c(5,6,7)])+
  gg_theme() +
  # facet_grid(~speakerGuise) +
  geom_point(size=2, alpha=0.5) +
  geom_smooth(method='lm', se=F)


```

```{r}

ind_data_coded %>% group_by(participantId) %>% filter(time_elapsed == min(time_elapsed)) %>% ungroup() %>% filter(speakerGuise!="BL") %>% mutate(EQgroups.4 = as.numeric(cut_number(EQscore_all, 4))) %>%
  mutate(EQgroups.4 = case_when(EQgroups.4 == 1 ~ "low",
                                EQgroups.4 == 2 ~ "mid-low",
                                EQgroups.4 == 3 ~ "mid-high",
                                EQgroups.4 == 4 ~ "high")) %>%
  relocate(EQgroups.4, .after=Ethnicity) %>%
  mutate(EQgroups.4 = factor(EQgroups.4, levels  = c("high", "mid-high", "mid-low", "low"))) %>%
  
  ggplot(aes(x=SAscore_all, y=guiseBias_prop, color=EQgroups.4))  +
  scale_color_manual(values=ghibli_palette("MononokeMedium")[c(2,5,6,7)])+
  gg_theme() +
  facet_grid(~speakerGuise) +
  geom_point(size=2, alpha=0.5) +
  geom_smooth(method='lm', se=F)


```